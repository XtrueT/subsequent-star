---
import ToggleBtn from "./ToggleBtn.astro";
---

<details
  open
  id='togglebar'
  class='flex flex-col justify-center items-center fixed bottom-5 -right-full z-50 theme'
  style='margin-right: calc(100% - 100vw);'>
  <summary class='list-none p-2 flex items-center justify-center hover:bg-primary hover:text-primary-light'>
    <svg
      xmlns='http://www.w3.org/2000/svg'
      width='24'
      height='24'
      viewBox='0 0 24 24'
      ><path
        fill='none'
        class='stroke-current'
        stroke-linecap='round'
        stroke-linejoin='round'
        stroke-width='1.5'
        d='M7 4v16m10-1V4m-7 3S7.79 4 7 4S4 7 4 7m16 10s-2.21 3-3 3s-3-3-3-3'
      ></path></svg
    >
  </summary>

  <ToggleBtn
    id='backtop-toggle'
    text='返回顶部'>
    <svg
      xmlns='http://www.w3.org/2000/svg'
      width='24'
      height='24'
      viewBox='0 0 48 48'
      ><g
        fill='none'
        class='stroke-current'
        stroke-linecap='round'
        stroke-linejoin='round'
        stroke-width='4'
        ><path d='M24.0083 14.1006V42.0001'></path><path d='M12 26L24 14L36 26'></path><path d='M12 6H36'></path></g
      ></svg
    >
  </ToggleBtn>
</details>
<script>


  document.addEventListener("astro:page-load", () => {
    const backtopToggle = document.getElementById("backtop-toggle");
    const header = document.getElementById('header-title');

    // 使用 Intersection Observer API 观察 header 元素是否在视窗内
    const headerObserver = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          document.getElementById("togglebar")?.classList.toggle("-right-full", entry.isIntersecting);
          document.getElementById("togglebar")?.setAttribute("open", `${!entry.isIntersecting}`);
          document.getElementById("togglebar")?.classList.toggle("right-5", !entry.isIntersecting);
        });
      },
      {
        root: null, // 相对于视口观察
        rootMargin: "-20%",
        threshold: 0.1, // 元素与视口交叉的阈值
      }
    );
    // 开始观察 header 元素
    if (header) {
      headerObserver.observe(header);
    }

    // 返回顶部按钮点击事件
    backtopToggle?.addEventListener("click", () => {
      // 平滑滚动到顶部
      window.scrollTo({
        top: 0,
        left: 0,
        behavior: "smooth",
      });
    });
  });
</script>
