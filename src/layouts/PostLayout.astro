---
import FormattedDate from "@components/FormattedDate.astro";
import SliceList from "@components/SliceList.astro";
import Tag from "@components/Tag.astro";
import TagCloud from "@components/TagCloud.astro";
import Tocbar from "@components/Tocbar.astro";
import ValineComm from "@components/ValineComm.astro";
import { config } from "@config";
import type { CollectionEntry } from "astro:content";
import DefaultLayout from "./DefaultLayout.astro";

interface Props {
  entry: CollectionEntry<"blog">;
}
const { entry } = Astro.props;
const { headings } = await entry.render();

const { title, description, pubDate, author, heroImage, tags, categories } =
  entry.data;
---

<DefaultLayout
  title={title}
  description={description ? description : entry.body.substring(0, 150)}
  keyword={`${tags.join(",")},${categories.join(",")}`}
>
  <div class="min-h-screen flex justify-between items-start flex-wrap w-full">
    <aside
      class="flex flex-col order-2 justify-start items-center basis-full lg:basis-1/3 md:pl-2 lg:sticky max-md:relative lg:top-20"
    >
      <TagCloud />
      <Tocbar headings={headings} title={title} />
      <SliceList title="相关文章" entry={entry} />
    </aside>
    <div
      class="flex flex-col order-1 justify-start items-center flex-auto w-full lg:relative min-h-screen lg:overflow-y-auto"
    >
      <h1 class="text-3xl font-bold">{title}</h1>
      <div
        class="flex justify-start items-baseline space-x-1 text-zinc-500 text-sm"
      >
        <span>{author}</span>
        <span>发布于</span>
        <FormattedDate date={pubDate} />
        {
          tags.map((tag) => (
            <a href={`/tags/${tag}`}>
              <Tag tag={tag} />
            </a>
          ))
        }
      </div>
      {
        heroImage && (
          <a href={href} title={title}>
            <figure id="heroImage" class="w-auto h-full min-w-28 min-h-20">
              <img
                src={heroImage}
                alt={title}
                loading="lazy"
                class="object-contain rounded-md"
              />
            </figure>
          </a>
        )
      }
      <article
        class="w-full p-5 prose-lg
              prose-h1:font-bold
              prose-a:text-blue-500 
            hover:prose-a:text-purple-500
              prose-p:text-justify
              prose-img:rounded-md
              prose-img:m-auto
              prose-headings:underline
              dark:prose-invert"
      >
        <slot />
      </article>
      {config.valine.enable && <ValineComm valine={config.valine} />}
    </div>
  </div>
</DefaultLayout>
